<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="icon" href="../../img/fy2000_tb.png">
<title>TV 小知识</title>
<style type="text/css">
#ys01 {
	text-align: center;
	font-weight: bold;
}
.ys02 {
	text-align: center;
}
.ys01 {
	font-family: "微软雅黑";
	text-align: center;
	font-size: 18px;
}
a:link {
	text-decoration: none;
}
a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
a:active {
	text-decoration: none;
	color: #E4E4E4;
	font-family: "微软雅黑";
	font-size: 14px;
}
.ys021 {
	font-size: 18px;
	color: #000;
	font-family: "微软雅黑";
}
.ysh12 {	font-family: "黑体";
	font-size: 36px;
	color: #F00;
}
.ysh21 {
	font-family: "黑体";
	font-size: 24px;
	color: #000;
}
.ysh05 {
	font-size: 36px;
	font-family: "微软雅黑";
	color: #E8DBE6;
}
.ysh06 .ysh09 .ys02 .ysh03 {
	font-family: "黑体";
}
.ysh2 {	font-family: "宋体";
	font-size: 24px;
	color: #009;
}
.ysh5 {
	font-family: "微软雅黑";
	font-size: 18px;
	color: #000;
}
.ysh41 li a {
	font-family: "微软雅黑";
}
.ysh51 {	font-family: "华文楷体";
	font-size: 18px;
}
.ysh61 {
	font-family: "黑体";
	font-size: 24px;
}
.ys022 {font-size: 14px;
	color: #000;
}
.ysh10 {	font-family: "隶书";
	font-size: 18px;
	color: #999;
}
.ys0211 {
	font-size: 14px;
	color: #06C;
}
.ys011 {	font-size: 18px;
	color: #06C;
}
</style>
<script type="text/javascript">
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
</script>
</head>

<body>
<p class="ys02"><img src="../img/item_top.gif" width="1000" height="53" alt="item_top" /></p>
<hr width="1000" />
<table width="1000" border="0" align="center" cellpadding="10">
  <tr>
    <td colspan="2" align="right" bgcolor="#C1C1FF"><span class="ys022">[<a href="#bottom">跳到末尾</a>][<a href="../TV_index.html">返回主页</a>]</span></td>
  </tr>
  <tr>
    <td colspan="2" align="center" bgcolor="#C1C1FF" class="ysh1"><a name="top" id="top"></a><span class="ysh12">状态机认识</span></td>
  </tr>
  <tr>
    <td width="132" align="center" bgcolor="#99FFFF"><a href="tv_item/TV_sys.html" class="ys01">知识模块</a></td>
    <td width="822" valign="middle" bgcolor="#E8E8D7">（以下内容都是基于Mstar NonOS软件架构而言）</td>
  </tr>
  <tr align="center">
    <td align="center" valign="top" bgcolor="#69B6DA"><p><a href="TV_sys.html" class="ys01">TV系统</a><br />
      <a href="Vital_func.html" class="ys01">重要函数体<br />
      </a><a href="State_machine.html" class="ys01">状态机</a><br />
      <a href="Timer.html" class="ys01">软定时器</a><br />
      <a href="IR.html" class="ys01">红外遥控<br />
    </a><a href="Keypad.html" class="ys01">按键板<br />
    </a><a href="tv_item/Skintool.html" class="ys01"></a><a href="Skintool.html" class="ys01">Skintool<br />
    </a><a href="other.html" class="ys01">其它</a></p></td>
    <td width="822" align="left" valign="top" bgcolor="#E8E8D7"><p class="ysh22">概要：</p>
      <ol class="ysh41">
        <li><a href="#jbyj">NonOs状态机的基本语句</a></li>
        <li><a href="#jbjg">NonOs状态机的基本架构</a></li>
        <li><a href="#jbyl">NonOs状态机的基本原理</a></li>
        <li><a href="#why">为什么要使用状态机</a></li>
        <li><a href="#how">如何使用状态机</a></li>
    </ol></td>
  </tr>
  <tr align="center">
    <td rowspan="6" valign="top" bgcolor="#69B6DA">&nbsp;</td>
    <td width="822" align="left" valign="top" bgcolor="#E8E8D7" class="ys021"><p class="ysh31"><span class="ysh22"><span class="ysh41"><a name="jbyj" id="jbyj"></a></span></span><span class="ysh21">一、NonOs状态机的基本语句</span></p>
    <p class="ysh5"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态机以我自己的认知，其实是可以从字面意思上理解的。就是管理状态的机制。既然是一种软件机制，那它肯定就有软件语言来实现。NonOs中的状态机是有switch\case语句描述的。当然这个机制也一定要在不停的工作才能及时的处理状态的跳转，因此这种机制一般都会被困在一个while循环中。</p></td>
  </tr>
  <tr align="center">
    <td align="left" valign="top" bgcolor="#E8E8D7" class="ys021"><p><span class="ysh2"><a name="jbjg" id="jbjg"></a></span><span class="ysh21">二、NonOs状态机的基本架构</span></p>
    <p><span class="ysh5">这里我们来认识一下状态机的软件架构，如下所示：</span></p>
    <p><span class="ysh5">while(1)</span><span class="ysh5"><br />
    {<br />
    </span><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp; switch(state_flag)</span><span class="ysh5"><br />
   &nbsp;&nbsp;&nbsp;&nbsp; {</span><span class="ysh5"><br />
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case state1:</span><span class="ysh5"><br />
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 动作1;</span><span class="ysh5"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case state2:</span><span class="ysh5"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
动作2;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="ysh5">&nbsp;&nbsp; ............<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ysh5">default:</span><span class="ysh5"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
动作n;</span><span class="ysh5"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}<br />
</span><span class="ysh5">}</span></p>
    <p><span class="ysh51"><span class="ysh5">上图即为状态机的基本组成，具体参考<a href="#TVSWSTY">TV软件系统</a>。</span></span><span class="ysh5"></span></p></td>
  </tr>
  <tr align="center">
    <td align="left" valign="top" bgcolor="#E8E8D7" class="ys021"><p class="ysh21"><a name="jbyl" id="jbyl"></a>三、NonOs状态机的基本原理</p>
    <p class="ysh21"><span class="ysh51"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 原理想必大家看了架构之后基本已经理解。程序跑起来之后有一个初始的状态，当状态机检测时会让机制进入默认状态运行，然后状态机会自己从初始化状态切换到稳定的状态，此时，状态机才算是正真开始干活。通过对状态标志位的判定，状态机会切换到对应的状态运行。</span></span></p>
    <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 那么状态标志位是在哪里切换的呢？一般情况下状态机运行在那个状态，那么对应的标志位切换的动作就在此状态下。目前的架构，状态机被运用与很多地方，接触最多的就是UI层中的状态机，因为UI层每一个菜单都是一个状态，用户界面的菜单必定是许许多多的，所有的标志为的转换都是在状态下面的动作中执行的。</span></p>
    <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上面已经了解到，状态机是在不断的重复的运行，那么很多时候我们是不需要菜单显示，不需要状态转变的，但是状态机没有因此而停止，这时候怎么办呢？你会发现状态机中有一个重要的状态就是 wait 状态，所有的状态切换完成后，都会进入 wait 状态，来确保状态不出错，如果不动作那就永远在wait状态，那么你又想，一直停在wait状态岂不是浪费CPU资源，这个软件设计者早就想好了，在wait状态中其实我们可以做很多事情，比如：外部输入的检测等等。</span></p>
    <p class="ysh21"><span class="ysh5">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 还有一个比较重要的地方需要注意：那就是我们在切换状态的时候，顺序一定是先将旧状态复位然后再将新状态置位，除了一些特殊的操作，否则一定是这样，这样可以避免掉很多的雷区。</span></p></td>
  </tr>
  <tr align="center">
    <td align="left" valign="top" bgcolor="#E8E8D7" class="ys021"><p class="ysh21"><a name="why" id="why"></a>三、为什么要使用状态机</p>
    <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态机一般见于大型的代码中，它是一种软件机制，同时也是一种软件框架。大型的软件，代码量是很大的，使用状态机可以有效的将繁冗的代码模块化，这些模块互相联系，拼凑为一个大型的代码堆，合理的使用状态机可以提高代码的质量，不管是代码的精度还是代码的架构都很清晰，提高阅读质量的同时，也会提高查找和分析问题的速度。</span></p>
    <p class="ysh21"><span class="ysh5">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态机还可以提高CPU的利用率，试想，对于单线程的软件程序，如果不使用状态机，那么在遇到等待，延时，或者检测这些问题的时候，往往CPU就会被指控，降低利用效率，但是使用状态机处理的话，可以有效的解决。</span></p>
    <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态机还可以处理一些复杂的事件，有些事件的处理不是顺序的，有时会被打断，存在状态的跳变，这种的话一般都会采用状态机来实现。</span></p></td>
  </tr>
  <tr align="center">
    <td align="left" valign="top" bgcolor="#E8E8D7"><p class="ysh21"><a name="how" id="how"></a>四、如何使用状态机</p>
      <p class="ysh21"><span class="ysh5">讲一个目前来说添加的还不错的一个状态-------老化状态。</span></p>
      <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 旧的code中老化状态一般都是开发人员添加，之前都是添加在一个本来就有个状态中的，添加的比较散，功能实现OK，但是有时在解决问题是会对其它状态产生影响，而且移植性不高。后来明白了状态机的原理，于是就大胆的将老化单独来作为一个状态跑，确实使代码架构清晰了很多，移植也方便。具体可以在代码中搜索状态 STATE_TOP_BURN_IN，软后在如下函数中查看</span></p>
      <p class="ysh21"><span class="ysh5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void MApp_TopStateMachine(void)</span></p>
<p class="ysh21"><span class="ysh12"><a name="bottom" id="bottom"></a>感谢阅读</span></p></td>
  </tr>
  <tr align="center">
    <td width="822" align="right" valign="top" bgcolor="#E8E8D7"><span class="ys0211"><span class="ys022">[<a href="../TV_index.html">返回主页</a>]</span>[<a href="#top">返回顶部</a>]</span></td>
  </tr>
  <tr>
    <td colspan="2" align="center" bgcolor="#FF9999"><span class="ysh61">※※※※※※※※※※※※※※※※</span><span class="ysh06"><span class="ysh09"><span class="ys02"><span class="ysh03"><span class="ys021"><span class="ysh09"><span class="ysh51"><span class="ysh51"><span class="ysh61">【</span></span></span></span></span></span></span></span></span><span class="ysh61">札 记 分 享</span><span class="ysh06"><span class="ysh09"><span class="ys02"><span class="ysh03"><span class="ys021"><span class="ysh09"><span class="ysh51"><span class="ysh51"><span class="ysh61">】※※※※※※※※※※※※※※※※</span></span></span></span></span></span></span></span></span></td>
  </tr>
  <tr>
    <td height="100" colspan="2" align="center" background="../img/背景2.jpg" class="ysh05">每一朵花都有盛开的理由，不论什么</td>
  </tr>
</table>
<hr align="center" width="1000" />
<table width="1000" border="0" align="center">
  <tr>
    <td class="ysh10">本想沉溺于莲花深处，不料翻滚于水物之间</td>
  </tr>
  <tr>
    <td><span class="ys0211">更新日期 
  &nbsp;&nbsp;
  &nbsp;
  <!-- #BeginDate format:fCh2m -->2018年2月8日 星期四   12:05<!-- #EndDate -->
    </span></td>
  </tr>
  <tr>
    <td><span class="ys011">欢迎访问官网 www.fy2000.org 蓝天的精灵工作室</span></td>
  </tr>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p class="ys02">&nbsp;</p>
</body>
</html>
